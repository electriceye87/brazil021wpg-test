<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members Portal | Brazil 021 Winnipeg</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        :root {
            --brazil-green: #2d5f42;
            --brazil-yellow: #fdd835;
            --brazil-blue: #5d76a0;
            --text-dark: #1a1a1a;
            --bg-light: #f4f6f5;
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-dark); }

        /* --- NAVIGATION --- */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 10px 5%; background: white; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: 100px; }
        .logo-text img { height: 85px; }
        
        .nav-links { display: flex; align-items: center; gap: 20px; }
        .nav-links a { text-decoration: none; color: var(--text-dark); font-weight: 600; font-size: 0.95rem; }
        .nav-links .active-link { color: var(--brazil-green); border-bottom: 2px solid var(--brazil-yellow); }
        .section-jump { color: var(--brazil-blue) !important; font-size: 0.85rem !important; text-transform: uppercase; }

        .hamburger { display: none; flex-direction: column; gap: 6px; cursor: pointer; background: none; border: none; padding: 10px; }
        .hamburger span { display: block; width: 30px; height: 3px; background-color: var(--brazil-green); border-radius: 3px; }

        @media (max-width: 900px) {
            .hamburger { display: flex; }
            .nav-links {
                display: none; position: fixed; top: 0; right: 0; width: 100%; height: 100vh;
                background: var(--brazil-green); flex-direction: column; justify-content: center; z-index: 2000;
            }
            .nav-links.open { display: flex; }
            .nav-links a { color: white !important; font-size: 1.5rem !important; margin: 15px 0; font-weight: bold; text-transform: uppercase; }
            .section-jump { color: var(--brazil-yellow) !important; } 
            .close-btn { display: block !important; color: white; font-weight: bold; margin-bottom: 50px; cursor: pointer; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; border: 1px solid rgba(255,255,255,0.4); padding: 10px 25px; border-radius: 5px; }
        }

        /* --- PORTAL ELEMENTS --- */
        #passwordGate { position: fixed; inset: 0; background-color: var(--brazil-green); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; color: white; text-align: center; padding: 20px; }
        #passwordGate img { height: 100px; margin-bottom: 20px; }
        #passwordGate input { width: 100%; max-width: 280px; padding: 15px; margin: 10px 0; border-radius: 5px; border: none; text-align: center; font-size: 16px; outline: none; }
        #passwordGate button { width: 100%; max-width: 280px; padding: 15px; background: var(--brazil-yellow); color: var(--brazil-green); border: none; border-radius: 5px; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        .portal-hero { background: var(--brazil-green); color: white; padding: 50px 20px; text-align: center; }
        .portal-hero h1 { color: var(--brazil-yellow); font-size: 2.5rem; }
        
        .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .portal-section { background: white; border-radius: 12px; padding: 30px; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); scroll-margin-top: 120px; }
        .section-title { color: var(--brazil-green); border-left: 6px solid var(--brazil-yellow); padding-left: 15px; margin-bottom: 25px; font-size: 1.6rem; text-transform: uppercase; }

        .newsletter-item { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee; gap: 20px; }
        .newsletter-item span { font-weight: 600; color: var(--brazil-green); font-size: 1.1rem; flex: 1; }
        .newsletter-item a { background: var(--brazil-yellow); color: var(--brazil-green); padding: 12px 20px; border-radius: 6px; text-decoration: none; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; transition: 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); white-space: nowrap; display: inline-block; }
        .newsletter-item a:hover { background: #f0cc2d; transform: translateY(-1px); }
        @media (max-width: 600px) {
            .newsletter-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .newsletter-item a { width: 100%; text-align: center; }
        }

        /* --- VIDEO DASHBOARD --- */
        .video-controls { margin-bottom: 30px; background: #f9f9f9; padding: 20px; border-radius: 10px; }
        #portalSearch { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #ddd; margin-bottom: 20px; outline: none; }
        .filter-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .filter-btn { padding: 8px 15px; border-radius: 5px; border: 1px solid var(--brazil-green); background: white; cursor: pointer; font-weight: bold; color: var(--brazil-green); }
        .filter-btn.active { background: var(--brazil-green); color: white; }

        /* FIXED: Using auto-fill keeps videos normal sized */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        
        .video-item { background: #fff; border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
        .video-card { position: relative; padding-top: 56.25%; background: #000; }
        .video-card iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .video-info { padding: 15px; }
        .video-tag { display: inline-block; background: var(--bg-light); padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }

        footer { background-color: var(--brazil-green); color: white; padding: 60px 20px; text-align: center; }
        .close-btn { display: none; }
    </style>
</head>
<body>

<div id="passwordGate">
    <img src="logo.webp" alt="Logo">
    <input type="password" id="passInput" placeholder="Password">
    <button id="enterBtn">Enter Portal</button>
</div>

<div id="memberContent" style="display: none;">
    <nav>
        <div class="logo-text"><a href="index.html"><img src="logo.webp" alt="Logo"></a></div>
        <button class="hamburger" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <div class="nav-links" id="navLinks">
            <span class="close-btn" onclick="toggleMenu()">âœ• CLOSE</span>
            <a href="index.html">Home</a>
            <a href="#section-news" class="section-jump" onclick="toggleMenu()">News</a>
            <a href="#section-newsletters" class="section-jump" onclick="toggleMenu()">Newsletters</a>
            <a href="#section-videos" class="section-jump" onclick="toggleMenu()">Videos</a>
            <a href="#" onclick="alert('Coming Soon!')">Store</a>
 </div>
    </nav>

    <div class="portal-hero">
        <h1>Student Portal</h1>
        <p>Academy News, Techniques & Resources</p>
    </div>

    <div class="container">
        <section id="section-news" class="portal-section">
            <h2 class="section-title">Latest News</h2>
            <div id="news-container">Loading news...</div>
        </section>

        <section id="section-newsletters" class="portal-section">
            <h2 class="section-title">Newsletter Archive</h2>
            <div id="newsletter-container">Loading newsletters...</div>
        </section>

        <section id="section-videos" class="portal-section">
            <h2 class="section-title">Technique Library</h2>
            <div class="video-controls">
                <input type="text" id="portalSearch" placeholder="Search techniques..." onkeyup="runFilters()">
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="setCategory('all', this)">All</button>
                    <button class="filter-btn" onclick="setCategory('chokehold', this)">Chokehold</button>
                    <button class="filter-btn" onclick="setCategory('joint-lock', this)">Joint-lock</button>
                    <button class="filter-btn" onclick="setCategory('takedowns', this)">Takedowns</button>
                    <button class="filter-btn" onclick="setCategory('escapes', this)">Escapes</button>
                    <button class="filter-btn" onclick="setCategory('sweeps', this)">Sweeps</button>
                </div>
            </div>
            <div class="video-grid" id="video-container">Loading...</div>
        </section>
    </div>

    <footer>
        <p>Â© 2025 Brazil-021 Winnipeg | <a href="javascript:void(0)" onclick="logout()" style="color: white;">Logout</a></p>
    </footer>
</div>

<script>
    const NEWS_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTfg-lI2YjMDfZdXeUKN7PeP4fnd7I8aA3NFxINZjQx4PPQbLsLNXaGEas7ufEgEzCcj7d4vhUqTsUl/pub?gid=0&single=true&output=csv";
    const NEWSLETTER_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTfg-lI2YjMDfZdXeUKN7PeP4fnd7I8aA3NFxINZjQx4PPQbLsLNXaGEas7ufEgEzCcj7d4vhUqTsUl/pub?gid=335399623&single=true&output=csv";
    const VIDEO_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTfg-lI2YjMDfZdXeUKN7PeP4fnd7I8aA3NFxINZjQx4PPQbLsLNXaGEas7ufEgEzCcj7d4vhUqTsUl/pub?gid=17348161&single=true&output=csv";

    // Authentication Key
    const CORRECT_HASH = "-447244175"; 

    document.addEventListener('DOMContentLoaded', () => {
        if(localStorage.getItem('bjj_session') === 'active') {
            unlockPortal();
        }

        const input = document.getElementById('passInput');
        if(input) {
            input.addEventListener('keypress', (e) => { 
                if (e.key === 'Enter') checkPassword(); 
            });
        }

        const btn = document.getElementById('enterBtn');
        if(btn) {
            btn.addEventListener('click', checkPassword);
        }
    });

    function checkPassword() {
        const inputField = document.getElementById('passInput');
        const input = inputField.value;

        if (!input) { return; }

        let hash = 0;
        for (let i = 0; i < input.length; i++) {
            let char = input.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; 
        }
        let userHash = hash.toString();

        if (userHash == CORRECT_HASH) {
            unlockPortal();
        } else {
            alert("Incorrect password.");
            inputField.value = ""; 
        }
    }

    function unlockPortal() {
        document.getElementById('passwordGate').style.display = "none";
        document.getElementById('memberContent').style.display = "block";
        window.scrollTo(0,0);
        localStorage.setItem('bjj_session', 'active');
        loadAllPortalData();
    }

    function logout() {
        localStorage.removeItem('bjj_session');
        location.reload();
    }

    // --- DATA LOADING ---
    
    function loadAllPortalData() {
        if (typeof Papa === 'undefined') { return; }
        
        loadSheet(NEWS_SHEET_URL, 'news-container', renderNews);
        loadSheet(NEWSLETTER_SHEET_URL, 'newsletter-container', renderNewsletters);
        loadSheet(VIDEO_SHEET_URL, 'video-container', renderVideos, true);
    }

    function loadSheet(url, containerId, renderFunc, isVideo = false) {
        Papa.parse(url, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data;
                if (isVideo) videoData = data; 
                renderFunc(data, containerId);
            },
            error: function(err) {
                console.error("Error loading sheet:", err);
            }
        });
    }

    // --- RENDERING ---
    let currentCategory = 'all';
    let videoData = [];

    function toggleMenu() {
        document.getElementById('navLinks').classList.toggle('open');
    }

    function renderNews(data, id) {
        let html = '';
        data.forEach(item => {
            if(!item.title) return;
            html += `<div style="background:#f9f9f9; padding:20px; border-radius:8px; border-left:4px solid var(--brazil-green); margin-bottom:15px; text-align:left;">
                <h3 style="color:var(--brazil-green)">${item.title}</h3><p>${item.body}</p><small>${item.date}</small></div>`;
        });
        document.getElementById(id).innerHTML = html;
    }

    function renderNewsletters(data, id) {
        let html = '';
        data.forEach(item => {
            if(!item.name) return;
            html += `<div class="newsletter-item"><span>${item.name}</span><a href="${item.link}" target="_blank">ðŸ“„ View PDF</a></div>`;
        });
        document.getElementById(id).innerHTML = html;
    }

    function renderVideos(data, id) {
        let html = '';
        data.forEach(item => {
            if(!item.title) return;
            html += `<div class="video-item" data-category="${item.category}" data-title="${item.title.toLowerCase()}">
                <div class="video-card"><iframe src="https://www.youtube.com/embed/${item.youtubeId}" allowfullscreen></iframe></div>
                <div class="video-info"><p class="video-title">${item.title}</p><span class="video-tag">${item.category.toUpperCase()}</span></div></div>`;
        });
        document.getElementById(id).innerHTML = html;
        runFilters();
    }

    function setCategory(cat, btn) {
        currentCategory = cat;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        runFilters();
    }

    function runFilters() {
        const search = document.getElementById('portalSearch').value.toLowerCase();
        const items = document.getElementsByClassName('video-item');
        for (let item of items) {
            const matchesSearch = item.getAttribute('data-title').includes(search);
            const matchesCat = currentCategory === 'all' || item.getAttribute('data-category') === currentCategory;
            item.style.display = (matchesSearch && matchesCat) ? "block" : "none";
        }
    }
</script>
</body>
</html>